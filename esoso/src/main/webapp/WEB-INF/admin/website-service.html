<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<meta name="renderer" content="webkit|ie-comp|ie-stand" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css"
	href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css"
	href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<style type="text/css">
table input {
	margin: 3px auto;
}
</style>
<title>站点服务</title>
</head>
<body>
	<div class="page-container" style="min-height: 500px">
		<table
			class="table table-border table-bordered table-bg mb-15 table-hover">
			<thead class="text-c">
				<tr>
					<th class="text-l f-18" colspan="10">站点服务管理</th>
				</tr>
				<tr>
					<th>序号</th>
					<th>站点名</th>
					<th>版本号</th>
					<th>创建时间</th>
					<th>创建人</th>
					<th>最近变更时间</th>
					<th>最近变更人</th>
					<th>站点收录数</th>
					<th>描叙</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody class="text-c">
				<tr th:each="item : ${Message}">
					<td th:text="${item.id}">1</td>
					<td th:text="${item.name}">segmentfault</td>
					<td th:text="${item.websiteId}">0.0.1</td>
					<td th:text="${item.createTime}">2017-3-28 20:14:16</td>
					<td th:text="${item.createMan}">Admin</td>
					<td th:text="${item.updateTime}">2017-4-29 14:33:15</td>
					<td th:text="${item.updateMan}">Admin</td>
					<td th:text="${item.nowNumber}">2</td>
					<td ><abbr title="超出就隐藏内容，我设置！" class="text-overflow" th:title="${item.sign}"
						style="width: 100px; display: inline-block" th:text="${item.sign}">超出就隐藏内容，我设置！</abbr></td>
					<td>
					<input class="btn btn-primary radius" type="button"
						value="配置" onclick="updateSettings('0.0.1','segmentfault')"
						th:onclick="|updateSettings('${item.websiteId}','${item.name}')|"/>
						<input class="btn radius btn-warning" type="button" value="站点停用"
						onclick="stopUsing('0.0.1','segmentfault')" th:onclick="|stopUsing('${item.websiteId}','${item.name}')|"/>
						</td>
				</tr>
			</tbody>
		</table>

		<div id="websiteSetting" class="modal fade" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content radius">
					<div class="modal-header">
						<h3 class="modal-title">服务詳情</h3>
						<a class="close" data-dismiss="modal" aria-hidden="true"
							href="javascript:void();">×</a>
					</div>
					<form action="#" id="form">
						<div class="modal-body"><input type="hidden"  name="id" value=""/><input type="hidden" name="name" value=""	/>
							<table class="table table-border table-bordered table-hover"
								id="">
								<thead>
									<tr>
										<th colspan="2">服务：针对同一链接地址</th>
									</tr>
									<tr>
										<th>服务名</th>
										<th>状态</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>搜索服务</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="SearchService"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>在线爬虫服务</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="OnlinePullData"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>定时爬虫服务</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="SchedulePullData"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>自定义爬虫服务</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="CustomPullData"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>直接访问</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="Visit"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>在线搜索</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="OnlineSearchService"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>安全访问</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="SecVisit"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>站點分析</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="WebsiteAnalysis"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>页面快照</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="PageShot" autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
									<tr>
										<td>版本服务</td>
										<td><span class="select-box"> <select
												class="select" size="1" name="VersionService"  autocomplete="off">
													<option value="0">否</option>
													<option value="1" selected="selected">是</option>
											</select>
										</span></td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="modal-footer">
							<button class="btn btn-primary"  type="submit">确定</button>
							<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	
	
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>

	<script type="text/javascript"
		src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript"
		src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript"
		src="lib/jquery.validation/1.14.0/messages_zh.js"></script>

	<script type="text/javascript">
	//<![CDATA[
		var updateSettings = function(id, name) {
			if (id && name) {
				$.get("website/info/web/getWebsiteService",{id:id,name:name}).done(function(data){
					if(data&&data.items){
						var $form = $("#form");
						$.each(data.items,function(i,v){
							if(v&&v.using==false){
								var $l = $form.find("select[name='"+v.name+"']").children("option");
								$.each($l,function(z,q){
									var v = $(q).val();
									if(v==0){
										$(q).attr("selected",true);
									}
								})
							}
						})
					}
					$("#form").find("input[name='id']").val(id);
					$("#form").find("input[name='name']").val(name);
	 				$("#websiteSetting").modal("show");
				}).fail(function(){
					layer.msg('请求失败!', {
					    time: 1000, icon: 5
					  });
				});
	 		} else {
				layer.msg("参数有误!", {
					icon : 2,
					time : 1500
				});
			}
		}
		var stopUsing = function(id, name) {
			if (id && name) {
				layer.confirm('确认停用站点所有“服务”吗？', {
					btn : [ '确定', '放弃' ],
					icon : 0
				}, function() {
					$.ajax({
						url : "website/settings/web/stopWebsiteService",
						type : "post",
						data : {
							id : id,
							name : name
						}
					}).done(function(data) {
						if (data && data.message) {
							layer.msg(data.message, {
								time : 1000,
								icon : 1
							});
						} else {
							layer.msg('操作成功!', {
								time : 1000,
								icon : 1
							});
						}
					}).fail(function() {
						layer.msg('请求失败', {
							icon : 5,
							time : 1000
						});
					});
				});
			} else {
				layer.msg("参数有误!", {
					icon : 2,
					time : 1500
				});
			}
		}
		//]]>
	</script>
	
	<script type="text/javascript">
	//<![CDATA[
		var openPage = function(title, url) {
			var index = layer.open({
				type : 2,
				title : title,
				content : url
			});
			layer.full(index);
		}
		//]]>
	</script>
	
	<script type="text/javascript">
	//<![CDATA[
		$(function() {
			$("#form").validate({
				rules : {
					name : {
						required : true
					},
					id : {
						required : true
					},
					SearchService : {
						required : true,
					},
					OnlinePullData : {
						required : true
					},
					SchedulePullData : {
						required : true
					},
					CustomPullData : {
						required : true
					},
					Visit : {
						required : true
					},
					SecVisit : {
						required : true
					},
					WebsiteAnalysis : {
						required : true
					},
					SortService : {
						required : true
					}
				},
				onkeyup : false,
				focusCleanup : true,
				success : "valid",
				submitHandler : function(form) {
					// 判断依赖默认版本是否点击，点击需要选择版本
					layer.confirm('确认修改吗？', {
						btn : [ '确定', '放弃' ],
						icon : 0
					}, function() {
						$(form).ajaxSubmit({
							url : "website/settings/web/updateWebsiteService",
							type : "post",
							success : function(data) {
								if (data) {
									if (data.message) {
										layer.msg(data.message, {
											time : 1000,
											icon : 6
										});
									} else {
										layer.msg('修改成功!', {
											time : 1000,
											icon : 1
										});
									}
									$("#websiteSetting").modal("hide");
								}
							},
							error : function() {
								layer.msg('请求失败', {
									icon : 5,
									time : 1000
								});
							}
						});
					})
				}
			});
		})
		//]]>
	</script>
</body>
</html>
