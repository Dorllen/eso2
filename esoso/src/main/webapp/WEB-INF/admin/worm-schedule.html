<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css"
	href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css"
	href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css"
	href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<style type="text/css">
@media screen and (min-width:768px) {
	div.modal-dialog {
		width: 80%;
	}
}
</style>

<title>定时计划</title>
</head>
<body>
	<div class="page-container">
		<div style="min-height: 600px">
			<form action="#" id="searchForm">
				<div class="text-l mt-5 bk-gray pd-5">
					站点搜索：<span class="select-box mr-10"
						style="max-width: 150px; display: inline-block"> <select
						class="select" id="type" name="type" autocomplete="off">
							<option value="website" selected>站点名称</option>
							<option value="type2">类型2</option>
							<option value="type3">类型3</option>
					</select>
					</span><span id="changeInput"><input type="text" name="value" id="search_text"
						style="width: 250px" class="input-text"
						placeholder="站点名:segmentfault" autocomplete="off" /></span>
					<button name="" id="search_button" class="btn btn-success"
						type="submit">
						<i class="Hui-iconfont">&#xe665;</i> 搜索
					</button>
				</div>
			</form>
			<div class="cl pd-5 bg-1 bk-gray mt-10 mb-10">
				<span class="l"><a class="btn btn-primary radius"
					onclick="openPage('新增计划','worm-schedule-add.html')"
					href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 新增计划</a> 
					<a class="btn btn-success radius"
					onclick="openPage('额外计划列表','worm-schedule-extras.html')"
					href="javascript:;"><i class="Hui-iconfont">&#xe64b;</i> 额外扫描计划</a>
					</span>
			</div>
			<table
				class="table table-border table-bordered table-bg mb-15 table-hover" id="table">
				<thead>
					<tr>
						<th colspan="5" scope="col">定時计划列表</th>
					</tr>
					<tr class="text-c">
						<td>站点名</td>
						<td>类型2</td>
						<td>类型3</td>
						<td>级别</td>
						<td>操作</td>
					</tr>
				</thead>
				<tbody class="text-c">
					<tr>
						<td>segmentfault</td>
						<td>问答</td>
						<td>内容详情页</td>
						<td><span class="label label-success radius">每周</span></td>
						<td><input class="btn btn-success radius" type="button"
							value="详情" onclick="showSettings(1,'segmentfault')"/> 
							<input class="btn btn-primary radius" type="button"
							value="配置" onclick="updateSettings(1,'segmentfault')"/> <input
							class="btn btn-warning radius" type="button" value="挂起" onclick="guaqi(1,'segmentfault')"/> 
						</td>
					</tr>
				</tbody>
			</table>
			<table
				class="table table-border table-bordered table-bg mb-15 table-hover" id="table1" style="display:none">
				<thead>
					<tr>
						<th colspan="5" scope="col">定時任務列表</th>
					</tr>
					<tr class="text-c">
						<td>站点名</td>
						<td>类型2</td>
						<td>类型3</td>
						<td>级别</td>
						<td>操作</td>
					</tr>
				</thead>
				<tbody  class="text-c" is="item1" v-bind:items="items" v-if="items!=null">
					<tr>
						<td>segmentfault</td>
						<td>问答</td>
						<td>内容详情页</td>
						<td><span class="label label-success radius">每周</span></td>
						<td><input class="btn btn-success radius" type="button"
							value="详情" onclick="showSettings(1,'segmentfault')"/> 
							<input class="btn btn-primary radius" type="button"
							value="配置" onclick="updateSettings(1,'segmentfault')"/> <input
							class="btn btn-warning radius" type="button" value="挂起" onclick="guaqi(1,'segmentfault')"/>
						</td>
					</tr>
				</tbody>
				<tfoot class="text-c" v-if="items==null||items.length==0">
					<tr>
						<th colspan="4">数据为空...</th>
					</tr>
				</tfoot>
			</table>
		</div>
		<div id="scheduleInfo" class="modal fade" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content radius">
					<div class="modal-header">
						<h3 class="modal-title">可操作配置</h3>
						<a class="close" data-dismiss="modal" aria-hidden="true"
							href="javascript:void();">×</a>
					</div>
					<div class="modal-body">
						<table class="table table-border table-bordered table-hover" id="table2">
							<tbody class="text-c" is="item2" v-bind:item="item">
							</tbody>
						</table>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">确定</button>
						<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
					</div>
				</div>
			</div>
		</div>
		<div id="scheduleUpdate" class="modal fade" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content radius">
					<div class="modal-header">
						<h3 class="modal-title">配置变更</h3>
						<a class="close" data-dismiss="modal" aria-hidden="true"
							href="javascript:void();">×</a>
					</div>
					<form action="#" id="updateForm">
						<div class="modal-body">
								<table class="table table-border table-bordered table-hover" id="table3">
									<tbody class="text-c">
										<tr>
											<th>站點名</th>
											<td>segmentfault</td>
											<th>类型2</th>
											<td><span class="select-box">
												<select class="select" autocomplete="off" name="type2">
													<option value="answer" selected>问答</option>
												</select></span></td>
											<th>类型3</th>
											<td><span class="select-box">
												<select class="select" autocomplete="off" name="type3">
													<option value="websites" selected>内容详情页</option>
												</select></span></td>
										</tr>
										<tr>
											<th colspan="6">采集规则</th>
										</tr>
										<tr>
											<th colspan="2">热度</th>
											<th>最大</th>
											<td><input type='text' name='hotMax'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
											<th>最小</th>
											<td><input type='text' name='hotMin'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
										</tr>
										<tr>
											<th colspan="2">访问量</th>
											<th>最大</th>
											<td><input type='text' name='viewsMax'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
											<th>最小</th>
											<td><input type='text' name='viewsMin'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
										</tr>
										<tr>
											<th colspan="2">收藏量</th>
											<th>最大</th>
											<td><input type='text' name='colletsMax'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
											<th>最小</th>
											<td><input type='text' name='colletsMin'  class='input-text' placeholder='可以为空,为空代表不设置' autocomplete='off'  /></td>
										</tr>
										<tr>
											<th colspan="2">级别</th>
											<td colspan="4"><span class="select-box">
												<select class="select" autocomplete="off" name="level">
													<option value="3Day" selected>每三天</option>
													<option value="week">每周</option>
													<option value="month" >每月</option>
												</select></span></td>
										</tr>
										<tr>
											<th colspan="2">描述</th>
											<td colspan="4"><textarea  class="textarea radius" name="sign" id="sign" autocomplete="off" placeholder="信息的描叙..."></textarea></td>
										</tr>
									</tbody>
								</table>
						</div>
						<div class="modal-footer">
							<button class="btn btn-primary" type="submit">确定</button>
							<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>

		<script type="text/javascript" src="js/vue.min.js"></script>		
		<script type="text/javascript">
			Vue.component("item1",{
				props:["items"],
				template:"<tbody><tr v-for='item in items'><td>{{item.name}}</td><td>{{item.type2}}</td><td>{{item.type3}}</td><td><span class=\"label label-success radius\">{{item.level}}</span></td><td><input class=\"btn btn-success radius\" type=\"button\" value=\"详情\" onclick=\"showSettings(item.id,item.name)\"/><input class=\"btn btn-primary radius\" type=\"button\" value=\"配置\" onclick=\"updateSettings(item.id,item.name)\"/> <input 	class=\"btn btn-warning radius\" type=\"button\" value=\"挂起\" onclick=\"guaqi(item.id,item.name)\"/> </td></tr></tbody>",
				methods:{
					showSettings:function(id,name){
						showSettings(id,name);
					},
					updateSettings:function(id,name){
						updateSettings(id,name);
					},
					guaqi:function(id,name){
						guaqi(id,name);
					}
				}
			})
			var vm1 = new Vue({
				el:"#table1",
				data:{
					items:[{name:'abd'}]
				}
			})
			Vue.component("item2",{
				props:["item"],
				template:"<tbody class=\"text-c\"><tr><th>站點名</th><td>{{item.name}}</td><th>类型2</th><td>{{item.type2}}</td><th>类型3</th><td>{{item.type3}}</td></tr>"+
				"<tr><th colspan=\"6\">采集规则</th></tr>"+
				"<tr><th colspan=\"2\">热度</th><th>最大</th><td>{{item.hot.max}}</td><th>最小</th><td>{{item.hot.min}}</td></tr>"+
				"<tr><th colspan=\"2\">访问量</th><th>最大</th><td>{{item.views.max}}</td><th>最小</th><td>{{item.views.min}}</td></tr>"+
				"<tr><th colspan=\"2\">收藏量</th><th>最大</th><td>{{item.collets.max}}</td><th>最小</th><td>{{item.collets.min}}</td></tr>"+
				"<tr><th colspan=\"2\">级别</th><td colspan=\"4\">{{item.level}}</td></tr>"+
				"<tr><th colspan=\"2\">描述</th><td colspan=\"4\">{{item.sign}}</td></tr></tbody>"
			})
			var vm2 = new Vue({
				el:"#table2",
				data:{
					item:{
						name:'segmentfault',type2:'问答',type3:'内容详情页',hot:{max:'',min:'234'},views:{max:'',min:'34'},collets:{max:'16',min:'10'}
					}
				}
			});
			Vue.component("item3",{
				props:["item"],
				template:""
			})
			var vm3 = new Vue({
				el:"#table3",
				data:{
					item:null
				}
			})
			
		</script>
		<script type="text/javascript">
			var guaqi  = function(id,name){
				if (id && name) {
					layer.confirm('确定挂起吗？', {
						btn : [ '确定', '放弃' ],
						icon : 0
					}, function() {
			 			$.ajax({url:"",type:"patch",data:{id:id,name:name}}).done(function(data){
			 				
			 			}).fail(function(){
			 				layer.msg('请求失败!', {
								time : 1000,
								icon : 5
							});
			 			})
					})
		 		} else {
					layer.msg("参数有误!", {
						icon : 2,
						time : 1500
					});
				}				
			}
		 	var showSettings = function(id,name){
		 		if (id && name) {
			 		$("#scheduleInfo").modal("show");
		 		} else {
					layer.msg("参数有误!", {
						icon : 2,
						time : 1500
					});
				}
		 	}
		 	var updateSettings = function(id,name){
				if (id && name) {
			 		$("#scheduleUpdate").modal("show");
		 		} else {
					layer.msg("参数有误!", {
						icon : 2,
						time : 1500
					});
				}		 		
		 	}
		</script>
		<script type="text/javascript">
			$(function(){
 				$("#searchForm").on("input","input#search_text",function(){
					var v = $(this).val();
					if(!v){
						$("#table").show();
						$("#table1").hide();
					}
				})
				$("select#type").on("change",function(){
					var value = $(this).val();
					if(value == 'type2'){
						// 移除输入框，显示下拉列表
						$("span#changeInput").empty();
						$("span#changeInput").append("<span class='select-box mr-10' style='max-width: 150px; display: inline-block'><select name='type2' class='select'><option value='answer' selected>问答</option></select></span>");
					}else if(value == 'type3'){
						// 移除下拉列表
						$("span#changeInput").empty();
						$("span#changeInput").append("<span class='select-box mr-10' style='max-width: 150px; display: inline-block'><select name='type3' class='select'><option value='segmentfault' selected>内容详情页</option></select></span>");
					}else if(value == 'website'){
						$("span#changeInput").empty();
						$("span#changeInput").append("<input type='text' id='search_text'	style='width: 250px' class='input-text' placeholder='站点名:segmentfault' autocomplete='off'  />");
					}
				});
			})
		</script>
		<script type="text/javascript"
			src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript"
			src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript"
			src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript">
		$(function(){
			$("#searchForm").validate({
				rules:{
					value:{
						required:true
					},
					type2:{
						required:true
					},
					type3:{
						required:true
					}
				},
				onkeyup:false,
				focusCleanup:true,
				success:"valid",
				submitHandler:function(form){
					$(form).ajaxSubmit({
						url:"/ss",
						type:"get",
						success:function(data){
							$("#table"),hide();
							$("#table1").show();
							if(data&&data.items){
								vm1.items = data.items;
							}
						},
						error:function(){
							layer.msg('请求失败!', {
								time : 1000,
								icon : 5
							});
						}
					})
				}
			});
			$("#updateForm").validate({
				rules:{
					type2:{
						required:true
					},
					type3:{
						required:true
					},
					level:{
						required:true
					}
				},
				submitHandler:function(form){
					layer.confirm('确定变更记录吗？', {
						btn : [ '确定', '放弃' ],
						icon : 0
					}, function() {
						$(form).ajaxSubmit({
							url:"/ss",
							type:"get",
							success:function(data){
								layer.msg('更新成功!', {
									time : 1000,
									icon : 1
								});
							},
							error:function(){
								layer.msg('请求失败!', {
									time : 1000,
									icon : 5
								});
							}
						})
					});
				}
			});
		})
		</script>		
		
		<script type="text/javascript">
			var openPage = function(title,url){
				var index = layer.open({
					type : 2,
					title : title,
					content : url
				});
				layer.full(index);
			}
		</script>
</body>
</html>